# 智能飞镖感应设备测试代码说明

## 测试项目概述

本测试项目针对智能飞镖感应设备进行全面的功能测试和接口测试，包括数据传送机接口和靶体接口的容错处理测试。

## 测试文件说明

### 1. 1shoot.lua - 飞镖信息输入功能测试

**测试目的：** 测试数据传送机向感应设备发送飞镖信息的功能

**测试内容：**
- 测试轻镖（类型1）和重镖（类型2）的正常输入
- 测试飞镖数量边界值（1, 10, 20等）
- 测试飞镖数量超出范围的情况（0, 21, 255）
- 测试未知物类型的处理（类型值为0或3等）

**测试数据来源：** testdata/data.yml中的shoot部分

**运行文件：** run/1shoot.run

### 2. 2target.lua - 靶区信息接收功能测试

**测试目的：** 测试感应设备接收靶体投中区域信息的功能

**测试内容：**
- 测试所有有效区域（1-5）的接收
  - 1: 内牛眼区域
  - 2: 外牛眼区域
  - 3: 三倍区域
  - 4: 双倍区域
  - 5: 单倍区域
- 测试无效区域值的处理（0, 6等）

**测试数据来源：** testdata/data.yml中的target部分

**运行文件：** run/2target.run

### 3. 3interface_shoot.lua - 数据传送机接口容错测试

**测试目的：** 测试数据传送机接口的容错处理能力

**测试内容：** 根据需求文档3.1节的要求进行全面的接口容错测试

1. **包头错误测试** - 发送包头为0x5511而非0xAA55的数据包，验证丢包处理
2. **数据标志错误测试** - 发送数据标志为0xCC而非0xBB的数据包，验证丢包处理
3. **包尾错误测试** - 发送包尾为0xAA55而非0x55AA的数据包，验证丢包处理
4. **校验和错误测试** - 发送错误校验和0xFF的数据包，验证丢包处理
5. **正确数据包测试** - 发送完全正确的数据包，验证正常接收
6. **多字段错误测试** - 发送多个字段都错误的数据包，验证丢包处理
7. **部分字段错误测试** - 发送部分字段错误的数据包，验证丢包处理
8. **系统恢复测试** - 在错误数据包后发送正确数据包，验证系统恢复正常

**运行文件：** run/3interface_shoot.run

### 4. 4interface_target.lua - 靶体接口容错测试

**测试目的：** 测试靶体接口的容错处理能力

**测试内容：** 根据需求文档3.2节的要求进行全面的接口容错测试

1. **包头错误测试** - 发送包头为0x5511而非0xAA55的数据包，验证丢包处理
2. **数据标志1错误测试** - 发送数据标志1为0xBB而非0xCC的数据包，验证丢包处理
3. **数据标志2错误测试** - 发送数据标志2为0x22而非0x11的数据包，验证丢包处理
4. **包尾错误测试** - 发送包尾为0xAA55而非0x55AA的数据包，验证丢包处理
5. **校验和错误测试** - 发送错误校验和0xFF的数据包，验证丢包处理
6. **投中区域值错误测试(0)** - 发送无效区域值0的数据包，验证丢包处理
7. **投中区域值错误测试(6)** - 发送超出范围的区域值6的数据包，验证丢包处理
8. **正确数据包测试(内牛眼)** - 发送正确的内牛眼区域数据包，验证正常接收
9. **正确数据包测试(三倍区)** - 发送正确的三倍区域数据包，验证正常接收
10. **多字段错误测试** - 发送多个字段都错误的数据包，验证丢包处理
11. **系统恢复测试** - 在错误数据包后发送正确数据包，验证系统恢复正常

**运行文件：** run/4interface_target.run

## 测试数据文件

### testdata/data.yml

测试数据文件包含两部分：

**shoot部分：** 用于飞镖信息输入测试
- 包含有效的轻镖和重镖测试数据
- 包含边界值测试数据（数量1, 20）
- 包含异常值测试数据（数量0, 21, 255；类型0, 3等）

**target部分：** 用于靶区信息接收测试
- 包含所有有效区域值（1-5）
- 包含无效区域值（0, 6）

## 协议格式

### 数据传送机协议（shoot.prot）

| 字节号 | 长度(bit) | 字段 | 内容 |
|--------|-----------|------|------|
| 0-1 | 16 | 包头 | 0xAA55，大端字节序 |
| 2 | 8 | 数据标志 | 固定值 0xBB |
| 3 | 8 | 飞镖类型 | 1:轻镖, 2:重镖, 其他:未知物 |
| 4 | 8 | 飞镖数量 | 无符号整形，[1-20] |
| 5 | 8 | 校验和 | 从第2号到4号字节按字节累加和 |
| 6-7 | 16 | 包尾 | 0x55AA，大端字节序 |

### 靶体协议（target.prot）

| 字节号 | 长度(bit) | 字段 | 内容 |
|--------|-----------|------|------|
| 0-1 | 16 | 包头 | 0xAA55，大端字节序 |
| 2 | 8 | 数据标志1 | 0xCC |
| 3 | 8 | 投中区域 | 1:内牛眼, 2:外牛眼, 3:三倍, 4:双倍, 5:单倍 |
| 4 | 8 | 数据标志2 | 0x11 |
| 5 | 8 | 校验和 | 从第2号到4号字节按字节累加和 |
| 6-7 | 16 | 包尾 | 0x55AA，大端字节序 |

## 容错处理要求

### 数据传送机接口容错要求（需求3.1）
1. 当接收到的校验和字段发生错误时，应做丢包处理
2. 当接收到的数据帧的包头、数据标志、包尾字段值不正确时，应做丢包处理

### 靶体接口容错要求（需求3.2）
1. 当接收到的校验和字段发生错误时，应做丢包处理
2. 当接收到的数据帧的包头、数据标志1、投中区域、数据标志2、包尾字段的值错误时，应做丢包处理

## 测试执行说明

1. 测试采用半自动化方式，需要测试人员根据提示进行确认
2. 每个测试案例发送数据后，会弹出对话框询问测试人员是否观察到预期结果
3. 测试人员需要观察被测设备的界面显示，根据实际情况回答"是"或"否"
4. 测试框架会根据回答自动判断测试是否通过，并生成测试报告

## 测试环境配置

- COM_shoot：波特率9600，8位数据位，无奇偶校验，1位停止位（serial_232接口）
- COM_target：波特率9600，8位数据位，无奇偶校验，1位停止位（serial_232接口）

配置文件位于：env/env.env

## 注意事项

1. 测试前请确保被测设备已正确连接并处于待测状态
2. 测试过程中请仔细观察被测设备的界面显示
3. 接口容错测试中，"丢包处理"意味着设备不应显示该数据包的内容
4. 测试日志会详细记录每个测试案例的执行情况
5. 建议按顺序执行测试：1shoot → 2target → 3interface_shoot → 4interface_target

## 参考文档

- CST2025嵌入式分赛--省赛--需求文档.pdf
- CST2025嵌入式分赛--省赛--测试要求.pdf
- CST2025嵌入式分赛--省赛--评分规则.pdf
